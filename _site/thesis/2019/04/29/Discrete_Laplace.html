<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Discrete Laplace Beltrami</title>
    <link rel="stylesheet" href="/assets/css/styles.css">
    <head>
<script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber:     "all" } } }); </script>
   <script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       tex2jax: {
         inlineMath: [ ['$','$'], ["\\(","\\)"] ],
         processEscapes: true
       }
     });
   </script>
     <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"     type="text/javascript"></script>
</head>

  </head>
    <body>
      <header class="site-header">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">MvO</a>
  
    
      <nav class="site-nav">
        <!--<input type="checkbox" id="nav-trigger" class="nav-trigger" />-->
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
            <a class="page-link" href="/about.html">About</a>
            
          
            
            
            <a class="page-link" href="/">Projects</a>
            
          
            
            
          
            
            
            <a class="page-link" href="/thesis.html">Thesis</a>
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>

      <div class="page-content">
        <div class="wrapper">
      <h1>Discrete Laplace Beltrami</h1>
<p>
  29 Apr 2019
</p>

<p>This post show the implementation of the discrete laplace operator. See the github repo for the jupyter notebook.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">'../..'</span><span class="p">)</span>

<span class="o">%</span><span class="n">load_ext</span> <span class="n">autoreload</span>
<span class="o">%</span><span class="n">autoreload</span> <span class="mi">2</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">vtki</span>

<span class="kn">import</span> <span class="nn">scipy.sparse.linalg</span> <span class="k">as</span> <span class="n">splinalg</span>
<span class="kn">from</span> <span class="nn">modules</span> <span class="kn">import</span> <span class="n">ddg</span>
<span class="kn">from</span> <span class="nn">modules.trimesh</span> <span class="kn">import</span> <span class="n">trimesh</span>
<span class="kn">from</span> <span class="nn">plyfile</span> <span class="kn">import</span> <span class="n">PlyData</span><span class="p">,</span> <span class="n">PlyElement</span>
<span class="kn">from</span> <span class="nn">vtki</span> <span class="kn">import</span> <span class="n">PolyData</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>

<span class="k">def</span> <span class="nf">read_ply</span><span class="p">(</span><span class="n">f_name</span><span class="p">):</span>
    <span class="c"># Read the vertices and triangles from a ply file</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">PlyData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">f_name</span><span class="p">)</span>
    
    <span class="n">data_vert</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span> <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">'vertex'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>
    <span class="n">data_tri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'face'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">'vertex_indices'</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">trimesh</span><span class="p">(</span><span class="n">data_vert</span><span class="p">,</span> <span class="n">data_tri</span><span class="p">)</span>

<span class="n">f_bunny</span> <span class="o">=</span> <span class="s">'../../test_data/bunny_36k.ply'</span>
<span class="n">bunny</span> <span class="o">=</span> <span class="n">read_ply</span><span class="p">(</span><span class="n">f_bunny</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="discrete-laplace-beltrami">Discrete Laplace Beltrami</h1>

<p>The discrete laplace beltrami operator is defined as $A^{-1}L$ where:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
  L_{ij} &= \begin{cases}
    (\cot(\alpha_{ij}) + \cot(\beta_{ij}))/2 & ij \in int(E) \\
    \cot(\alpha_{ij})/2 & ij \in \partial(E) \\
    -\sum_{k\neq i} L_{ik} & i =j \\
    0 & else
  \end{cases}
\end{align*} %]]></script>

<p>And $A$ is a weight matrix. Defined as the vertext ares, see <a href="https://www.cs.cmu.edu/~kmcrane/Projects/DDG/">DIscrete DIfferential Geometry - An Applied Introduction</a> for more information.</p>

<p>In the smooth setting the spectrum in infinite. In the discrete case the operator can be described by a finite matrix, thus we only have a finite spectrum. Given a smooth compact manifold without boundary then the Laplace Beltrami operator is semi negative definite</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
\int \Delta f \cdot f  &= \langle  \Delta f, f\rangle \\
& =  -\langle \nabla f ,\nabla f \rangle \\
& = - \int \| \nabla f \|^2 \leq 0
\end{align*} %]]></script>

<p>If further $f$ is assumed to be in the kernel we get that $\int | \nabla f | ^2 = 0$, which is only the case for constant functions.</p>

<p>Note the matrix is very sparse as the values on row $i$ only depends on the neighbors of that point. Computationally is will be very efficient to use sparse matrices.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create the cotan-matrix together with the weight matrix. The area calculated is the dual cell area. </span>
<span class="n">L</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">ddg</span><span class="o">.</span><span class="n">discrete_laplacian</span><span class="p">(</span><span class="n">bunny</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="solving-using-scipy">Solving using scipy</h1>

<p>The goal is to find eigenfunction and values, $\Delta f = \lambda f$. Say we want the eigenfunction with the ‘lowest frequency’ then we need the $K$ eigenfunction belonging to the $K$ smallest (in absolute value) eigenvalues .</p>

<p>The Laplace Beltrami operator can be given as $\Delta = A^{-1}L$, thus the equation becomes $A^{-1}L f = \lambda f \Rightarrow Lf = \lambda Af$. This last equation is a generalised eigenvalue problem, and there are special solvers for this.</p>

<p>The <code class="highlighter-rouge">sparse.linalg.eigsh</code> is the function that meets our requirements. Note that $A$ and $L$ are both symmetric matrices. We have to give the following keyword argument <code class="highlighter-rouge">which ='SM'</code> to calculate the smallest (in magnitude) eigenvalues and corresponding eigenfunctions, the vector are sorted in the algebraic ordering.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">time</span>
<span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">splinalg</span><span class="o">.</span><span class="n">eigsh</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">A</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="n">which</span> <span class="o">=</span> <span class="s">'SM'</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 3min 10s, sys: 17.1 s, total: 3min 27s
Wall time: 1min 44s
</code></pre></div></div>

<p>As you can see it takes quite a while to calculate the smallest eigenvalues/functions. The underlying ARPACK package can more efficiently calculate the largest eigenvalue problem.</p>

<p>For this we can rewrite our equation $L f = \lambda Af \Rightarrow \frac{1}{\lambda} L f = A f$. (<strong>note</strong> solving this eigen problem will transform the potential $0$ eigenvalue to a huge number.</p>

<p>Now transforming it like this, we have to use the keyword <code class="highlighter-rouge">mode = 'buckling'</code> because the matric $L$ is not necessarily positive (semi-)definite, this also requires a <code class="highlighter-rouge">sigma</code> argument. This sigma will transform the eigenvalues $\lambda’ = \lambda / (\lambda - \sigma)$, since $\lambda \leq 0$ then if $\sigma &gt;0$ the ordering of the eigenvalues will reverse. The <code class="highlighter-rouge">which</code> argument applies to this transformed lambda.</p>

<p>In short, initially $0\geq \lambda_1 \geq \lambda_2\geq ….$ then with $1/\lambda$ it becomes $1/\lambda_1 \leq 1/\lambda_2 \leq … \leq 0$, finally the sigma transformation results $\lambda’_1 \geq \lambda’_2 \geq …\geq 0$</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">time</span>
<span class="n">val1</span><span class="p">,</span> <span class="n">vec1</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigsh</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">L</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s">'LM'</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s">'buckling'</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 1.32 s, sys: 184 ms, total: 1.5 s
Wall time: 766 ms
</code></pre></div></div>

<p>Initially with <code class="highlighter-rouge">which = 'SM'</code> the eigenvalues are sorted from smallest magnitude to largest. Now they are sorted smallest to largest. Thus we need to transform them back. If there is an original eigenvalue equal to $0$. It is now a big number in absolute value, i.e. positive or negative. Thus for sorting we have to take this into account.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">val1</span><span class="p">))[::]</span> <span class="c"># reverse the sort to make is eventually smallest to biggest</span>
<span class="n">final_val</span><span class="p">,</span> <span class="n">final_vec</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">val1</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">vec1</span><span class="p">[:,</span><span class="n">sort</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># See the equivalence of the methods</span>
<span class="c"># Note how we make sure the signs are the same</span>
<span class="c"># this is necessary since the solution Lf = af, implies the solution L(-f) = a(-f)</span>
<span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">final_vec</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">final_vec</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">vec</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>True
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plotter</span> <span class="o">=</span> <span class="n">vtki</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">view_vector</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">viewup</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

<span class="n">color_map</span> <span class="o">=</span> <span class="s">'jet'</span>


<span class="n">plotter</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">polydata</span> <span class="o">=</span> <span class="n">PolyData</span><span class="p">(</span><span class="n">bunny</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[[</span><span class="mi">3</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">bunny</span><span class="o">.</span><span class="n">triangles</span><span class="p">),</span><span class="n">bunny</span><span class="o">.</span><span class="n">triangles</span><span class="p">])</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s">'Eig val: {:.2f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">final_val</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">polydata</span><span class="p">,</span> <span class="n">scalars</span> <span class="o">=</span> <span class="n">final_vec</span><span class="p">[:,</span><span class="mi">4</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">view_vector</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">viewup</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>


<span class="n">plotter</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">polydata</span> <span class="o">=</span> <span class="n">PolyData</span><span class="p">(</span><span class="n">bunny</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[[</span><span class="mi">3</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">bunny</span><span class="o">.</span><span class="n">triangles</span><span class="p">),</span><span class="n">bunny</span><span class="o">.</span><span class="n">triangles</span><span class="p">])</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s">'Eig val: {:.2f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">final_val</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">polydata</span><span class="p">,</span> <span class="n">scalars</span> <span class="o">=</span> <span class="n">final_vec</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">view_vector</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">viewup</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                 
<span class="n">plotter</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">polydata</span> <span class="o">=</span> <span class="n">PolyData</span><span class="p">(</span><span class="n">bunny</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[[</span><span class="mi">3</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">bunny</span><span class="o">.</span><span class="n">triangles</span><span class="p">),</span><span class="n">bunny</span><span class="o">.</span><span class="n">triangles</span><span class="p">])</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s">'Eig val: {:.2f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">final_val</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">polydata</span><span class="p">,</span> <span class="n">scalars</span> <span class="o">=</span> <span class="n">final_vec</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">view_vector</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">viewup</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>


<span class="n">plotter</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">polydata</span> <span class="o">=</span> <span class="n">PolyData</span><span class="p">(</span><span class="n">bunny</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[[</span><span class="mi">3</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">bunny</span><span class="o">.</span><span class="n">triangles</span><span class="p">),</span><span class="n">bunny</span><span class="o">.</span><span class="n">triangles</span><span class="p">])</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s">'Eig val: {:.2f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">final_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">polydata</span><span class="p">,</span> <span class="n">scalars</span> <span class="o">=</span> <span class="n">final_vec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">view_vector</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">viewup</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>



<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/images/discrete_laplace/output_11_0.png" alt="png" /></p>

<p>Although this looks cool, we will look at the sphere to be able to compare the discrete version with known results</p>

<h1 id="examples">Examples</h1>

<p>To show how the eigenfunction look like we will regards the sphere, since the eigenfunctions are known for this manifold. These are called the <a href="https://en.wikipedia.org/wiki/Spherical_harmonics">spherical harmonics</a>.</p>

<h2 id="the-exact-case">The exact case</h2>

<p>To work with the sphere we need the sperical coordinates 
<script type="math/tex">\begin{align*}
(x,y,z) = (\sin(\theta)\cos(\phi), \sin(\theta)\sin(\phi), \cos(\theta))
\end{align*}</script></p>

<p>With $\theta \in [0,\pi]$ and $\phi \in [-\pi, \pi]$, we assume $r=1$.</p>

<p>Then the eigenfunction can be written down as
<script type="math/tex">\begin{align*}
\cos (m \phi) P_{l}^{m}(\cos \theta) \text{ and }\sin (m \phi) P_{l}^{m}(\cos \theta)
\end{align*}</script></p>

<p>With $l \in {0,1,2,…}$ and $m\in {0,1,…,l}$ with eigenvalue $\lambda = l(l+1)$. Below I will only regard the first, since the second is simply a rotation in the $z$ axis.
The function $P_l^m$ are the assiociated legendre polynomials.
<script type="math/tex">P_{l}^{m}(x) = \left(1-x^{2}\right)^{m / 2} \frac{d^{m}}{d x^{m}} P_{l}(x)</script>
Where $P_n$ are the legendre polynomials,
<script type="math/tex">\begin{align*}
P_0 = 1, P_1 = x, P_2 = \frac{1}{2}(3x^2 - 1)
\end{align*}</script></p>

<p>Higher order polynomial can be generated recursively $(n+1) P_{n+1}(x)=(2 n+1) x P_{n}(x)-n P_{n-1}(x)$</p>

<p>To not have to calculate the derivatives by hand we use the autograd from pytorch.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.autograd</span> <span class="kn">import</span> <span class="n">grad</span>

<span class="k">def</span> <span class="nf">legrandre_polynomial</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">l</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">legrandre_polynomial</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">legrandre_polynomial</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">l</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>

    
<span class="k">def</span> <span class="nf">nth_derivative</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">wrt</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>

        <span class="n">grads</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">wrt</span><span class="p">,</span> <span class="n">create_graph</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">grads</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">grads</span>

<span class="k">def</span> <span class="nf">Pml</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
    <span class="n">x_torch</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x_torch</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">()</span>

    <span class="n">P_l</span> <span class="o">=</span> <span class="n">legrandre_polynomial</span><span class="p">(</span><span class="n">x_torch</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>

    <span class="n">dp_l</span> <span class="o">=</span> <span class="n">nth_derivative</span><span class="p">(</span><span class="n">P_l</span><span class="p">,</span><span class="n">x_torch</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">x_torch</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span><span class="n">dp_l</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">harmonic</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
    <span class="n">cos_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">Pml</span><span class="p">(</span><span class="n">cos_theta</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">P</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sphere</span> <span class="o">=</span> <span class="n">read_ply</span><span class="p">(</span><span class="s">'../../test_data/sphere_uv_40k_new.ply'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">color_map</span> <span class="o">=</span> <span class="s">'jet'</span>

<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">sphere</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">vtki</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">))</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">eig</span> <span class="o">=</span> <span class="n">harmonic</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span> <span class="n">l</span><span class="p">)</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
        <span class="n">polydata</span> <span class="o">=</span> <span class="n">PolyData</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[[</span><span class="mi">3</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">triangles</span><span class="p">),</span><span class="n">sphere</span><span class="o">.</span><span class="n">triangles</span><span class="p">])</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s">'l: {},m: {}, eig_val : {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">polydata</span><span class="p">,</span> <span class="n">scalars</span> <span class="o">=</span> <span class="n">eig</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">)</span>


<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/images/discrete_laplace/output_16_0.png" alt="png" /></p>

<h2 id="numerical-solutions">Numerical solutions</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">L</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">ddg</span><span class="o">.</span><span class="n">discrete_laplacian</span><span class="p">(</span><span class="n">sphere</span><span class="p">)</span>
<span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigsh</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">M</span><span class="o">=-</span><span class="n">L</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s">'LM'</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s">'buckling'</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
<span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">val</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c"># reverse the sort to make is eventually smallest to biggest</span>
<span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">val</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">vec</span><span class="p">[:,</span><span class="n">sort</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">color_map</span> <span class="o">=</span> <span class="s">'jet'</span>

<span class="n">L</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">vtki</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">))</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="n">eig</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[:,</span><span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
    <span class="n">polydata</span> <span class="o">=</span> <span class="n">PolyData</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[[</span><span class="mi">3</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">triangles</span><span class="p">),</span><span class="n">sphere</span><span class="o">.</span><span class="n">triangles</span><span class="p">])</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s">'l: {},m: {},val : {:.2f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="p">]),</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">polydata</span><span class="p">,</span> <span class="n">scalars</span> <span class="o">=</span> <span class="n">eig</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">m</span><span class="o">+</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">eig</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[:,</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="o">-</span><span class="n">m</span><span class="p">)</span>
        <span class="n">polydata</span> <span class="o">=</span> <span class="n">PolyData</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[[</span><span class="mi">3</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">triangles</span><span class="p">),</span><span class="n">sphere</span><span class="o">.</span><span class="n">triangles</span><span class="p">])</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s">'l: {},m: {},val : {:.2f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">polydata</span><span class="p">,</span> <span class="n">scalars</span> <span class="o">=</span> <span class="n">eig</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">)</span>
        
        <span class="n">ind</span> <span class="o">=</span> <span class="n">m</span><span class="o">+</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">l</span>
        <span class="n">eig</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[:,</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
        <span class="n">polydata</span> <span class="o">=</span> <span class="n">PolyData</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[[</span><span class="mi">3</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">triangles</span><span class="p">),</span><span class="n">sphere</span><span class="o">.</span><span class="n">triangles</span><span class="p">])</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s">'l: {},m: {},val : {:.2f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">polydata</span><span class="p">,</span> <span class="n">scalars</span> <span class="o">=</span> <span class="n">eig</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">)</span>



<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/images/discrete_laplace/output_19_0.png" alt="png" /></p>

<p>As you can see the eigen functions look similar, note that we now also have the rotated eigen functions. The eigenvalues deviate from the actual eigenvalues.</p>

<h2 id="different-triangulations">Different triangulations</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iso_sphere</span> <span class="o">=</span> <span class="n">read_ply</span><span class="p">(</span><span class="s">'../../test_data/sphere_iso_40k.ply'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">L</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">ddg</span><span class="o">.</span><span class="n">discrete_laplacian</span><span class="p">(</span><span class="n">iso_sphere</span><span class="p">)</span>
<span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigsh</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">M</span><span class="o">=-</span><span class="n">L</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s">'LM'</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s">'buckling'</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
<span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">val</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c"># reverse the sort to make is eventually smallest to biggest</span>
<span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">val</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">vec</span><span class="p">[:,</span><span class="n">sort</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">color_map</span> <span class="o">=</span> <span class="s">'jet'</span>

<span class="n">L</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">vtki</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">))</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="n">eig</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[:,</span><span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
    <span class="n">polydata</span> <span class="o">=</span> <span class="n">PolyData</span><span class="p">(</span><span class="n">iso_sphere</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[[</span><span class="mi">3</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">iso_sphere</span><span class="o">.</span><span class="n">triangles</span><span class="p">),</span><span class="n">iso_sphere</span><span class="o">.</span><span class="n">triangles</span><span class="p">])</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s">'l: {},m: {},val : {:.2f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="p">]),</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">polydata</span><span class="p">,</span> <span class="n">scalars</span> <span class="o">=</span> <span class="n">eig</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">m</span><span class="o">+</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">eig</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[:,</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="o">-</span><span class="n">m</span><span class="p">)</span>
        <span class="n">polydata</span> <span class="o">=</span> <span class="n">PolyData</span><span class="p">(</span><span class="n">iso_sphere</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[[</span><span class="mi">3</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">iso_sphere</span><span class="o">.</span><span class="n">triangles</span><span class="p">),</span><span class="n">iso_sphere</span><span class="o">.</span><span class="n">triangles</span><span class="p">])</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s">'l: {},m: {},val : {:.2f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">polydata</span><span class="p">,</span> <span class="n">scalars</span> <span class="o">=</span> <span class="n">eig</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">)</span>
        
        <span class="n">ind</span> <span class="o">=</span> <span class="n">m</span><span class="o">+</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">l</span>
        <span class="n">eig</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[:,</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
        <span class="n">polydata</span> <span class="o">=</span> <span class="n">PolyData</span><span class="p">(</span><span class="n">iso_sphere</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[[</span><span class="mi">3</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">iso_sphere</span><span class="o">.</span><span class="n">triangles</span><span class="p">),</span><span class="n">iso_sphere</span><span class="o">.</span><span class="n">triangles</span><span class="p">])</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s">'l: {},m: {},val : {:.2f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">polydata</span><span class="p">,</span> <span class="n">scalars</span> <span class="o">=</span> <span class="n">eig</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">)</span>



<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/images/discrete_laplace/output_24_0.png" alt="png" /></p>

<p>Many eigenfunctions we can match with ones from the UV-triangulation. But they are definitely different. Triangulations do seem to matter quite a bit.</p>

<p>The triangulations are both approximations of the sphere, but they are different approximations. The uv-sphere has a larger symmetry group than the iso-sphere, and symmetries are important for the harmonic functions,</p>

<p>Furthermore the harmonic functions are assumed to be decomposable as $f(\phi, \theta) = f_1(\phi)f_2{\theta}$, the uv-sphere uses the same decomposition, that may be a reason why the uv-sphere is more similar to the exact case.</p>

<p>Finally, the eigenvalues of the iso-sphere are closer to the exact eigenvalues.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>


        </div>
      </div>

    </body>
</html>
